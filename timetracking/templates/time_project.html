{% extends 'adminlte/base.html' %}
{% load static %}
{% load labels %}


{% block stylesheets %}
{{ block.super}}
<link rel="stylesheet" type="text/css" href="{% static 'timetracking/fullcalendar/main.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'timetracking/daygrid/main.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'timetracking/timegrid/main.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'timetracking/list/main.css' %}"/>
{% endblock %}

{% block title %}RSE Group Administration Tool: View Project Timesheet{% endblock %}
{% block page_name %}RSE Group Administration Tool: View Project Timesheet{% endblock %}
{% block content %}

	<div class ="row">
        
		<div class="col-md-9">
          <div class="box box-solid">
            <div class="box-header with-border">
              <h3 class="box-title">Calendar</h3>
            </div>
            <div class="box-body">
				<canvas id="id_graph" width="100%"></canvas>			  
            </div>
          </div>
        </div>
		

		<div class="col-md-3">
          
			 <div class="box box-default">
				<div class="box-header with-border">
					<h3 class="box-title">Options</h3>
				</div>
				<form method='GET' id="filter_form">
					<div class="box-body">
						<div class="form-group">
							
							<label>Select RSE:</label>
							<p><i>All RSEs are included regardless of allocations</i><p>
							{{ form.rse }}
							</br>
							
							
							<label>Report Granularity</label>
							<p><i>The level at which the graph reports on accumulated effort</i></p>
							{{ form.granularity }}
							</br>
							
						</div>
					</div>
					<div class="box-footer">
						<button type="submit" class="btn btn-primary">Apply</button>
					</div>
				</form>

				</div>
			</div>
		  
        </div>
		
		
		
    </div>

    
    
    
{% endblock %}

{% block javascript %}
{{ block.super}}

<script language="javascript" src="{% static 'chartjs/moment.js' %}"></script>
<script language="javascript" src="{% static 'chartjs/Chart.js' %}"></script>
<script type="text/javascript">
	
    var ctx = $('#id_graph')[0].getContext('2d');
    var myChart = new Chart(ctx, {
            type: 'line',
            data: {
				
                datasets: [
					// RSE timesheet plot
					{
						label: "{{rse_name}}",
						//steppedLine: 'before',
						data: [
							{% for date, value in timsheet_days %}
								{
									"x": moment("{{date | date:'Y-m-d'}}"), 
									"y": {{value}},
									tooltip: "{{rse_name}} " + Math.floor({{value}}) + " days and " + Math.round(({{value}}%1)*{{WORKING_HOURS_PER_DAY}} *100)/100 + " hours", //days and hours to 2 dp
								},
							{% endfor %}
						],
						borderColor: 'rgba(0,255,0, 1.0)',//'rgba({{ plot_rse.colour_rbg.r }}, {{ plot_rse.colour_rbg.g }}, {{ plot_rse.colour_rbg.b }}, 1.0)',
						backgroundColor: 'rgba(0,255,0, 1.0)',//'rgba({{ plot_rse.colour_rbg.r }}, {{ plot_rse.colour_rbg.g }}, {{ plot_rse.colour_rbg.b }}, 1.0)',
						fill: false,
					},
					// project allocated days
					{
						label: "{{rse_name}} Allocated Days",
						//steppedLine: 'before',
						data: [
							{% for date, value in allocated_days %}
								{
									"x": moment("{{date | date:'Y-m-d'}}"), 
									"y": {{value}},
									tooltip: Math.floor({{value}}) + " days and " + Math.round(({{value}}%1)*{{WORKING_HOURS_PER_DAY}} *100)/100 + " hours", //days and hours to 2 dp
								},
							{% endfor %}
						],
						borderColor: 'rgba(0,0,255, 1.0)',
						backgroundColor: 'rgba(0,0,255, 1.0)',
						fill: false,
					},
					// project expected days
					{
						label: "Total Project Working Days",
						//steppedLine: 'before',
						data: [
							{% for date, value in project_days %}
								{
									"x": moment("{{date | date:'Y-m-d'}}"), 
									"y": {{value}},
									tooltip: Math.floor({{value}}) + " days and " + Math.round(({{value}}%1)*{{WORKING_HOURS_PER_DAY}} *100)/100 + " hours", //days and hours to 2 dp
								},
							{% endfor %}
						],
						borderColor: 'rgba(0,0,0, 1.0)',
						backgroundColor: 'rgba(0,0,0, 1.0)',
						fill: false,
					},
					// Today plot
					{
						label: "Current Date Today",  
						borderDash: [10,5] , 
						data: [
							
								{
									"x": moment("{% now 'Y-m-d'%}"), 
									"y": 0,
								},
								{
									"x": moment("{% now 'Y-m-d'%}"), 
									"y": {{project_working_days}},
								},
						],
						borderColor: 'rgba(255, 0, 0, 1.0)',
						backgroundColor: 'rgba(255, 255, 255, 1.0)',
						fill: false,
					},
                ]
            },
            options: {
				responsive: true,
				legend: {
						display: true,
					},
				scales: {
                    yAxes: [{
                        //stacked: true,
						scaleLabel: {
							display: true,
							labelString: 'Days'
						}
                    }],
                    xAxes: [{
                        type: 'time',
                        time: {
                            unit: 'month',
                            displayFormats: {
                                quarter: 'D MMM YYYY'
                            }
                        }
                    }]                    
                },
				tooltips: {
                    callbacks: {
                        label: function(tooltipItem, data) {
                            var label = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index].tooltip
                            return label;
                        }
					}	
                }
            }
    });
	

</script>
	
{% endblock %}